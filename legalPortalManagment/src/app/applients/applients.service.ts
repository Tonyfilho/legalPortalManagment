import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable, Subject, take } from 'rxjs';
import { IApplientClass } from 'src/assets/interfaces/appient';

@Injectable({
  providedIn: 'root',
})
export class ApplientsService {
  /**variavel do dummy por falta do BACKEND */
  private localApplients: IApplientClass[] = [
    {
      id: 1,
      name: 'andre filho',
      email: 'andre@adentis.pt',
      admissionDate: new Date(2022, 1, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '918203555',
      emergencyContactPhone: '916203875',
      emergencyContactName: 'debora',
      degreeOfkinShip: 'esposa',
      naturalness: 'Benfica',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2030, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2030, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 2,
      name: 'tony filho',
      email: 'tonyfilho@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '918203784',
      emergencyContactPhone: '916203875',
      emergencyContactName: 'debora',
      degreeOfkinShip: 'esposa',
      naturalness: 'vitoria',
      nationality: 'Brasil',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 3,
      name: 'rui',
      email: 'rui@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '918203754',
      emergencyContactPhone: '916203875',
      emergencyContactName: 'debora',
      degreeOfkinShip: 'esposa',
      naturalness: 'vitoria',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 4,
      name: 'Marcelo',
      email: 'marcelo@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '9182037666',
      emergencyContactPhone: '916203875',
      emergencyContactName: '',
      degreeOfkinShip: 'esposa',
      naturalness: 'lisboa',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 5,
      name: 'Daniel',
      email: 'daniel@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '9182037666',
      emergencyContactPhone: '916203875',
      emergencyContactName: '',
      degreeOfkinShip: 'esposa',
      naturalness: 'lisboa',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 6,
      name: 'Bernado',
      email: 'bernado@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '9182037666',
      emergencyContactPhone: '916203875',
      emergencyContactName: '',
      degreeOfkinShip: 'esposa',
      naturalness: 'lisboa',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 6,
      name: 'Ricardo',
      email: 'ricardo@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '9182037666',
      emergencyContactPhone: '916203875',
      emergencyContactName: '',
      degreeOfkinShip: 'esposa',
      naturalness: 'lisboa',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
    {
      id: 7,
      name: 'Jose Salgueiro',
      email: 'ricardo@adentis.pt',
      admissionDate: new Date(2000, 11, 7),
      birthDate: new Date(2000, 11, 7),
      phone: '9182037666',
      emergencyContactPhone: '916203875',
      emergencyContactName: '',
      degreeOfkinShip: 'esposa',
      naturalness: 'lisboa',
      nationality: 'Portugal',
      address: 'afonso castro nº7 3ºesq',
      zipeCode: '2900677',
      locality: 'setubal',
      documentNumber: '197940es',
      documentValidityDate: new Date(2000, 11, 7),
      admissionPlace: 'Portugal',
      internationalID: 'sdahqhege',
      internationalValidity: '01/2030',
      internationalEmitDate: '01/2020',
      passportNumber: 'PASS38373jfjth',
      passportValidity: '01/2030',
      passportExpeditionDate: new Date(2000, 11, 7),
      vatNumber: '288249ggg',
      socialSecurity: '12034568765gh',
      maritalStatus: 'casado',
      numberOfDependents: 1,
      bankName: 'novoBanco',
      ibanName: 'PT5000000045464758576987',
      swiftName: 'SAVHTD',
      bicNumber: '00000045464758576987',
      nibNumber: '45464758576987',
      registrationVehicleNumber: '69CN10',
    },
  ];
  /**variavel do Subject para pegar os dados do Dummy e mandar em forma de OBSERVABLE p/ component */
  localApplients$!: Observable<IApplientClass[]>;

  /** variaveis do serviço de compartilhamento de ID */
  private localId = new BehaviorSubject<number>(0);
  serviceIdReturn = this.localId.asObservable();

  constructor(private httpClient: HttpClient) {
    this.localApplients$ = new Observable((data) => {
      data.next(this.localApplients);
    });
  }

  getApplients() {
    const localApplients = this.httpClient.get(
      `https://jsonplaceholder.typicode.com/users`
    ); //URL dummy para testar sucess or error
    return localApplients.pipe(take(1));
  }
  getApplientById(id: number) {
    const localApplients = this.httpClient.get(
      `https://jsonplaceholder.typicode.com/users/${id}`
    ); //URL dummy para testar sucess or error
    return localApplients.pipe(take(1));
  }

  getId(id: number): void {
    //emite um Observable do ID
    this.localId.next(id);
  }

  postUser(applient: IApplientClass) {
    this.localApplients.push(applient);
    return this.httpClient
      .post(
        `https://httpbin.org/post`, //URL dummy para testar sucess or error
        JSON.stringify(applient)
      )
      .pipe(take(1)); //JSON é uma API de JSON q o browser vai usar, o stringify é o metodo de conversão de Objeto JS / JSON.
  }

  getAllCountriesName() {
    return this.httpClient.get(`https://restcountries.com/v2/all?fields=name`);
  }
}
